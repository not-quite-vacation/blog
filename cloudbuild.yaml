steps:
- name: 'gcr.io/cloud-builders/go:alpine'
  args: ['get', 'github.com/spf13/hugo']
  env: ['PROJECT_ROOT=github.com/not-quite-vacation/blog']
- name: 'gcr.io/cloud-builders/go:alpine'
  args: ['get', 'github.com/mjibson/esc']
  env: ['PROJECT_ROOT=github.com/not-quite-vacation/blog']
- name: 'alpine'
  args: ['gopath/bin/hugo']
  dir: 'blog'
- name: 'gcr.io/cloud-builders/go:alpine'
  args: ['generate', 'blog/blog.go']
  env: ['PROJECT_ROOT=github.com/not-quite-vacation/blog']
- name: 'gcr.io/cloud-builders/go:alpine'
  args: ['install', 'preview']
  env: ['PROJECT_ROOT=github.com/not-quite-vacation/blog']
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'gcr.io/$PROJECT_ID/blog:$BRANCH_NAME', '.']
  dir: 'preview'

images: ['gcr.io/$PROJECT_ID/blog:$BRANCH_NAME']
